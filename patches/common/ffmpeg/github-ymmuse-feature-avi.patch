From cca69b45bbf1573581ade0108306ab4ac0c7e5a6 Mon Sep 17 00:00:00 2001
From: max <ymmuse@gmail.com>
Date: Wed, 18 Apr 2018 18:11:35 +0900
Subject: [PATCH] add avi decode files

---
 chromium/config/Chrome/mac/x64/config.asm |  4 ++--
 chromium/config/Chrome/mac/x64/config.h   |  7 ++++---
 ffmpeg_generated.gni                      | 13 +++++++++++++
 3 files changed, 19 insertions(+), 5 deletions(-)

diff --git a/chromium/config/Chrome/mac/x64/config.asm b/chromium/config/Chrome/mac/x64/config.asm
index 0252f913a2..6e8cedcaa0 100644
--- a/chromium/config/Chrome/mac/x64/config.asm
+++ b/chromium/config/Chrome/mac/x64/config.asm
@@ -1175,7 +1175,7 @@
 %define CONFIG_ASS_DEMUXER 0
 %define CONFIG_AST_DEMUXER 0
 %define CONFIG_AU_DEMUXER 0
-%define CONFIG_AVI_DEMUXER 0
+%define CONFIG_AVI_DEMUXER 1
 %define CONFIG_AVISYNTH_DEMUXER 0
 %define CONFIG_AVR_DEMUXER 0
 %define CONFIG_AVS_DEMUXER 0
@@ -2071,7 +2071,7 @@
 %define CONFIG_AST_MUXER 0
 %define CONFIG_ASF_STREAM_MUXER 0
 %define CONFIG_AU_MUXER 0
-%define CONFIG_AVI_MUXER 0
+%define CONFIG_AVI_MUXER 1
 %define CONFIG_AVM2_MUXER 0
 %define CONFIG_BIT_MUXER 0
 %define CONFIG_CAF_MUXER 0
diff --git a/chromium/config/Chrome/mac/x64/config.h b/chromium/config/Chrome/mac/x64/config.h
index 7e2db5b77b..21b07739b9 100644
--- a/chromium/config/Chrome/mac/x64/config.h
+++ b/chromium/config/Chrome/mac/x64/config.h
@@ -1,7 +1,8 @@
 /* Automatically generated by configure - do not modify! */
 #ifndef FFMPEG_CONFIG_H
 #define FFMPEG_CONFIG_H
-#define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-fft --enable-rdft --enable-static --enable-libopus --disable-bzlib --disable-error-resilience --disable-iconv --disable-lzo --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac' --enable-parser='opus,vorbis,flac' --extra-cflags=-I/Users/chcunningham/Code/chromium/src/third_party/opus/src/include --disable-linux-perf --optflags='\0-O2\0' --enable-decoder='theora,vp8' --enable-parser='vp3,vp8' --enable-pic --enable-yasm --cc=clang --cxx=clang++ --extra-libs=-lopus --arch=x86_64 --extra-cflags=-m64 --extra-ldflags=-m64 --enable-decoder='aac,h264,mp3' --enable-demuxer='aac,mp3,mov' --enable-parser='aac,h264,mpegaudio'"
+#define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-fft --enable-rdft --enable-static --enable-libopus --disable-bzlib --disable-error-resilience --disable-iconv --disable-lzo --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac' --enable-parser='opus,vorbis,flac' --extra-cflags=-I/Users/chcunningham/Code/chromium/src/third_party/opus/src/include --disable-linux-perf --optflags='\0-O2\0' --enable-decoder='theora,vp8' --enable-parser='vp3,vp8' --enable-pic --enable-yasm --cc=clang --cxx=clang++ --extra-libs=-lopus --arch=x86_64 --extra-cflags=-m64 --extra-ldflags=-m64 --enable-decoder='aac,h264,mp3' --enable-demuxer='aac,mp3,mov' --enable-parser='aac,h264,mpegaudio' --enable-decoder='avi'"
+
 #define FFMPEG_LICENSE "LGPL version 2.1 or later"
 #define CONFIG_THIS_YEAR 2017
 #define FFMPEG_DATADIR "/usr/local/share/ffmpeg"
@@ -1191,7 +1192,7 @@
 #define CONFIG_ASS_DEMUXER 0
 #define CONFIG_AST_DEMUXER 0
 #define CONFIG_AU_DEMUXER 0
-#define CONFIG_AVI_DEMUXER 0
+#define CONFIG_AVI_DEMUXER 1
 #define CONFIG_AVISYNTH_DEMUXER 0
 #define CONFIG_AVR_DEMUXER 0
 #define CONFIG_AVS_DEMUXER 0
@@ -2087,7 +2088,7 @@
 #define CONFIG_AST_MUXER 0
 #define CONFIG_ASF_STREAM_MUXER 0
 #define CONFIG_AU_MUXER 0
-#define CONFIG_AVI_MUXER 0
+#define CONFIG_AVI_MUXER 1
 #define CONFIG_AVM2_MUXER 0
 #define CONFIG_BIT_MUXER 0
 #define CONFIG_CAF_MUXER 0
diff --git a/ffmpeg_generated.gni b/ffmpeg_generated.gni
index a675a80917..a2e4f88eba 100644
--- a/ffmpeg_generated.gni
+++ b/ffmpeg_generated.gni
@@ -14,6 +14,19 @@ ffmpeg_yasm_sources = []
 
 use_linux_config = is_linux || is_fuchsia
 
+if ((is_win || is_mac || is_linux) && (current_cpu == "x86" || current_cpu == "x64")) {
+ffmpeg_c_sources += [
+    "libavformat/avidec.c",
+    "libavformat/avienc.c",
+    "libavformat/mpegtsenc.c",
+    "libavformat/avlanguage.c",
+    "libavformat/riffenc.c",
+    "libavformat/rawutils.c",
+    "libavcodec/exif.c",
+    "libavcodec/tiff_common.c",
+]
+}
+
 if ((is_android && current_cpu == "arm" && arm_use_neon) || (is_android && current_cpu == "arm64") || (is_android && current_cpu == "mips64el") || (is_android && current_cpu == "mipsel") || (is_android && current_cpu == "x64") || (is_android && current_cpu == "x86") || (is_mac) || (is_win) || (use_linux_config && current_cpu == "arm" && arm_use_neon) || (use_linux_config && current_cpu == "arm") || (use_linux_config && current_cpu == "arm64") || (use_linux_config && current_cpu == "mipsel") || (use_linux_config && current_cpu == "x64") || (use_linux_config && current_cpu == "x86")) {
   ffmpeg_c_sources += [
     "libavcodec/allcodecs.c",
-- 
2.15.1

